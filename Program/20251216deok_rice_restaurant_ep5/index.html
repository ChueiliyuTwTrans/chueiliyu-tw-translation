<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë•ë°¥ì§‘ EP.5 ìµœë¦½ìš° CHUEI LI YU<br/>(å¾·é£¯åº— EP.5 å´”ç«‹äº)</title>

<style>
body {
    margin: 0;
    background: #111;
    color: #fff;
    font-family: Arial, "Noto Sans TC", sans-serif;
    text-align: center;
}

/* å½±ç‰‡å®¹å™¨ */
#video-wrapper {
    position: relative;
    max-width: 960px;
    margin: 20px auto;
    background: black;
}

/* YouTube æ’­æ”¾å™¨ */
#player {
    width: 100%;
    aspect-ratio: 16 / 9;
}

/* ===== å­—å¹• ===== */
#subtitle {
    position: absolute;
    bottom: 6%;
    left: 50%;
    transform: translateX(-50%) scale(var(--subtitle-scale, 1));
    transform-origin: center bottom;
    width: 94%;
    font-size: 22px;
    line-height: 1.6;
    color: #fff;
    text-align: center;
    word-break: break-word;
    max-height: 40%;
    z-index: 10;
    pointer-events: none;
    text-shadow:
        2px 2px 4px #000,
       -2px 2px 4px #000,
        2px -2px 4px #000,
       -2px -2px 4px #000;
}

/* æ¡Œæ©Ÿéå…¨è¢å¹• */
@media (min-width: 1024px) {
    #subtitle {
        font-size: 28px;   /* ğŸ–¥ æ¡Œæ©Ÿæ¯”æ‰‹æ©Ÿå¤§ */
        line-height: 1.7;
    }
}

/* ========= å…¨è¢å¹•å…±ç”¨çµæ§‹ ========= */

:fullscreen #video-wrapper,
:-webkit-full-screen #video-wrapper {
    width: 100vw;
    height: 100vh;
    max-width: none;
    margin: 0;
}

:fullscreen #player,
:-webkit-full-screen #player {
    position: absolute;
    inset: 0;
    width: 100vw;
    height: 100vh;
}

/* ========= å…¨è¢å¹•å­—å¹•ï¼šè£ç½®åˆ†æµ ========= */

/* æ¡Œæ©Ÿå…¨è¢å¹• */
@media (min-width: 1024px) {
    :fullscreen #subtitle,
    :-webkit-full-screen #subtitle {
        font-size: 32px;
        line-height: 1.8;
    }
}

/* æ‰‹æ©Ÿ / å¹³æ¿å…¨è¢å¹• */
@media (max-width: 1023px) {
    :fullscreen #subtitle,
    :-webkit-full-screen #subtitle {
        font-size: 24px;
        line-height: 1.6;
    }
}

/* å…¨è¢å¹•æŒ‰éˆ• */
#fs-btn {
    margin: 10px;
    padding: 10px 16px;
    font-size: 16px;
    cursor: pointer;
}

/* ===== æ§åˆ¶åˆ— ===== */
#controls {
    display: inline-flex;
    gap: 10px;
    align-items: center;
    margin-bottom: 10px;
    font-size: 14px;
}

#controls button {
    padding: 6px 10px;
    font-size: 14px;
    cursor: pointer;
}

/* ===== é£Ÿè­œå€ ===== */
#recipe-section {
    max-width: 960px;
    margin: 30px auto 60px;
    padding: 0 16px;
    text-align: left;
}

.recipe-block {
    background: #1b1b1b;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
}

.recipe-block h3 {
    margin-top: 0;
    font-size: 20px;
    color: #ffd369;
}

.recipe-block ol {
    padding-left: 20px;
    line-height: 1.8;
    font-size: 15px;
}

.recipe-block li {
    margin-bottom: 6px;
}

</style>

</head>

<body>
<div id="controls">
    <button onclick="changeSubtitleSize(-0.1)">Aâˆ’</button>
    <span>å­—å¹•å¤§å°</span>
    <button onclick="changeSubtitleSize(0.1)">Aï¼‹</button>
    <button id="fs-btn">å…¨è¢å¹•</button>
</div>

<h2>ë•ë°¥ì§‘ EP.5 ìµœë¦½ìš° CHUEI LI YU<br/>(å¾·é£¯åº— EP.5 å´”ç«‹äº)</h2>

<div id="video-wrapper">
    <div id="player"></div>
    <div id="subtitle">å­—å¹•è¼‰å…¥ä¸­...</div>
</div>

<section id="recipe-section">

    <div class="recipe-block">
        <h3>~å´”ç«‹äº éº»å©†è±†è… å¾·é£¯åº— é£Ÿè­œ~</h3>
        <ol>
            <li>å°‡è±†è…åˆ‡æˆé©ç•¶å¤§å°çš„ç«‹æ–¹é«”ï¼Œæ´‹è”¥èˆ‡å¤§è”¥åˆ‡ç¢å‚™ç”¨ã€‚</li>
            <li>åœ¨å¹³åº•é‹ä¸­å€’å…¥é£Ÿç”¨æ²¹ï¼Œç¨å¾®åŠ ç†±å¾Œæ”¾å…¥å¤§è”¥èˆ‡è’œæœ«æ‹Œç‚’ã€‚</li>
            <li>åŠ å…¥è±¬è‚‰ã€æ´‹è”¥ã€è–‘æœ«ã€æ–™ç†é…’åŠå°‘è¨±é»‘èƒ¡æ¤’ç²‰ï¼Œä¸€èµ·ç¿»ç‚’ã€‚</li>
            <li>å°‡ç‚’å¥½çš„ææ–™åŠ å…¥è¾£æ¤’ç²‰ 1 å¤§åŒ™ã€è ”æ²¹ 1.5 å¤§åŒ™ã€é†¬æ²¹ 2 å¤§åŒ™ã€è±†ç“£é†¬ 1/2 å¤§åŒ™ã€ç ‚ç³– 3/4 å¤§åŒ™ï¼Œç¿»ç‚’è‡³å‡å‹»è£¹ä¸Šé†¬æ–™ã€‚</li>
            <li>åŠ å…¥æ¸…æ°´ï¼Œæ°´é–‹å§‹æ²¸é¨°å¾Œè½‰ä¸­ç«ç¹¼çºŒç…®ã€‚</li>
            <li>æ¹¯æ±å……åˆ†å…¥å‘³å¾Œï¼Œæ”¾å…¥è±†è…ï¼Œå†ç…®ç´„ 2 åˆ†é˜ï¼Œè®“è±†è…å¸æ”¶å‘³é“ã€‚</li>
            <li>å€’å…¥å¤ªç™½ç²‰æ°´ï¼Œä¸€é‚Šæ”ªæ‹Œèª¿æ•´æ¿ƒç¨ åº¦ï¼Œç²‰æ°´ç†Ÿé€å¾Œé—œç«ã€‚</li>
            <li>é—œç«å¾ŒåŠ å…¥ 1/2 å¤§åŒ™é¦™æ²¹ï¼Œå……åˆ†æ‹Œå‹»å³å¯ã€‚ </li>
        </ol>
    </div>

    <div class="recipe-block">
        <h3>~å´”ç«‹äº ç‰å­ç‡’ å¾·é£¯åº— é£Ÿè­œ~</h3>
        <ol>
            <li>å°‡æ‰€æœ‰è”¬èœéƒ½åˆ‡å¾—éå¸¸ç´°ç¢ã€‚</li>
            <li>æ‰“æ•£é›è›‹ï¼ŒåŠ å…¥è”¬èœã€é¹½å’Œç ‚ç³–æ‹Œå‹»ã€‚</li>
            <li>è›‹æ¶²ç…è‡³åŠç†Ÿæ™‚ï¼Œå¾ä¸€å´é–‹å§‹æŠ˜èµ·æ²èµ·ï¼Œæ¥è‘—å°‘é‡å€’å…¥è›‹æ¶²ï¼Œè®“è›‹çš®ç„¡ç¸«éŠœæ¥ï¼Œé‡è¤‡æ­¤æ­¥é©Ÿã€‚</li>
            <li>ç¬¬ä¸€å±¤æ²å¥½å¾Œæ¨åˆ°ä¸€æ—ï¼Œä¾ç›¸åŒæ–¹å¼åè¦†æ“ä½œï¼Œç›´åˆ°è›‹æ¶²ç”¨å®Œï¼Œæœ€å¾Œå†ç¨å¾®ç…ä¸€ä¸‹ï¼Œè®“å…§éƒ¨ä¹Ÿç†Ÿé€ã€‚</li>
        </ol>
    </div>

</section>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let player;
let subtitles = [];
let subtitleTimer = null;

const subtitleEl = document.getElementById("subtitle");
const wrapper = document.getElementById("video-wrapper");
const fsBtn = document.getElementById("fs-btn");

/* ===== å­—å¹•å¤§å°ï¼ˆè¨˜ä½è¨­å®šï¼‰ ===== */
let subtitleScale = parseFloat(
    localStorage.getItem("subtitle-scale")
) || 1;

applySubtitleScale();

function applySubtitleScale() {
    subtitleEl.style.setProperty("--subtitle-scale", subtitleScale);
}

function changeSubtitleSize(delta) {
    subtitleScale = Math.min(2, Math.max(0.6, subtitleScale + delta));
    localStorage.setItem("subtitle-scale", subtitleScale);
    applySubtitleScale();
}

/* è¼‰å…¥ SRT */
fetch("1216deok_rice_restaurant.srt")
    .then(res => {
        console.log("å­—å¹• HTTP ç‹€æ…‹ç¢¼ï¼š", res.status);
        if (!res.ok) throw new Error("å­—å¹•è®€å–å¤±æ•—");
        return res.text();
    })
    .then(text => {
        console.log("å­—å¹•åŸå§‹å…§å®¹å‰ 100 å­—ï¼š", text.slice(0, 100));
        subtitles = parseSRT(text);
        console.log("å­—å¹•è¼‰å…¥å®Œæˆï¼š", subtitles.length);
        document.getElementById("subtitle").innerText = "";
    })
    .catch(err => {
        console.error("å­—å¹•éŒ¯èª¤ï¼š", err);
        document.getElementById("subtitle").innerText = "å­—å¹•è¼‰å…¥å¤±æ•—";
    });

function toSeconds(time) {
    const parts = time.replace(",", ".").split(":");
    if (parts.length !== 3) return 0;

    const h = parseFloat(parts[0]);
    const m = parseFloat(parts[1]);
    const s = parseFloat(parts[2]);

    return h * 3600 + m * 60 + s;
}

function parseSRT(data) {
    data = data.replace(/\r/g, "").trim();

    const blocks = data.split(/\n{2,}/);

    return blocks.map(block => {
        const lines = block
            .split("\n")
            .map(l => l.trim())
            .filter(l => l && !/^\d+$/.test(l));

        const timeLine = lines.find(l => l.includes("-->"));
        if (!timeLine) return null;

        const times = timeLine.split("-->").map(t => t.trim());
        if (times.length !== 2) return null;

        const start = times[0];
        const end = times[1];

        const textLines = lines.slice(lines.indexOf(timeLine) + 1);
        if (!textLines.length) return null;

        return {
            start: toSeconds(start),
            end: toSeconds(end),
            text: textLines.join("<br>")
        };
    }).filter(Boolean);
}
    
/* YouTube */
function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
        videoId: "sN-cLYIy7po",
        playerVars: {
            start: 1,
            rel: 0,
            playsinline: 1
        },
        events: {
            onReady,
            onStateChange
        }
    });
}

function onReady(e) {
    const iframe = e.target.getIframe();
    iframe.setAttribute("allowfullscreen", "");
    iframe.setAttribute("webkitallowfullscreen", "");
}

/* æ’­æ”¾ä¸­æ‰åŒæ­¥å­—å¹• */
function onStateChange(e) {
    if (e.data === YT.PlayerState.PLAYING && !subtitleTimer) {
        startSubtitleSync();
    }
}

function startSubtitleSync() {
    subtitleTimer = setInterval(() => {
        if (!player || !subtitles.length) return;

        const t = player.getCurrentTime();

        const activeSubs = subtitles.filter(
            x => t >= x.start && t <= x.end
        );

        if (activeSubs.length) {
            subtitleEl.innerHTML = activeSubs
                .map(s => s.text)
                .join("<br>");
        } else {
            subtitleEl.innerHTML = "";
        }
    }, 200);
}

/* å…¨è¢å¹•æŒ‰éˆ•ï¼ˆæ¡Œæ©Ÿ / Android / éƒ¨åˆ†å¹³æ¿å¯ç”¨ï¼‰ */
fsBtn.addEventListener("click", () => {
    if (document.fullscreenElement || document.webkitFullscreenElement) {
        document.exitFullscreen?.();
        document.webkitExitFullscreen?.();
    } else {
        wrapper.requestFullscreen?.();
        wrapper.webkitRequestFullscreen?.();
    }
});
</script>

</body>
</html>

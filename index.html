<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>IDOL RADIO BEHIND EP#173</title>

    <style>
        body {
            font-family: Arial, "Noto Sans TC", sans-serif;
            background-color: #111;
            color: #fff;
            text-align: center;
        }

        #player {
            margin: 20px auto;
        }

        #subtitle {
            font-size: 22px;
            margin-top: 15px;
            padding: 10px;
            background: rgba(0,0,0,0.6);
            width: 80%;
            margin-left: auto;
            margin-right: auto;
            border-radius: 8px;
            min-height: 2em;
        }
    </style>
</head>

<body>

    <h2>IDOL RADIO BEHIND EP#173</h2>

    <!-- YouTube Player 容器 -->
    <div id="player"></div>

    <!-- 字幕 -->
    <div id="subtitle">字幕載入中...</div>

    <!-- YouTube Iframe API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <script>
let player;
let subtitles = [];

/* 讀取 SRT */
fetch("1123idol_radio_behind_ep173.srt")
    .then(res => res.text())
    .then(text => {
        subtitles = parseSRT(text);
        document.getElementById("subtitle").innerText = "";
    });

function parseSRT(data) {
    const blocks = data.trim().split(/\n\s*\n/);
    return blocks.map(block => {
        const lines = block.split("\n");
        const time = lines[1].split(" --> ");
        return {
            start: toSeconds(time[0]),
            end: toSeconds(time[1]),
            text: lines.slice(2).join("<br>")
        };
    });
}

function toSeconds(time) {
    const [h, m, s] = time.replace(",", ".").split(":");
    return (+h) * 3600 + (+m) * 60 + parseFloat(s);
}

/* YouTube API Ready */
function onYouTubeIframeAPIReady() {
    player = new YT.Player("player", {
        width: 800,
        height: 450,
        videoId: "_oV9Tz2eSHw",
        playerVars: {
            start: 1,
            rel: 0,
            modestbranding: 1
        },
        events: {
            onReady: startSubtitleSync
        }
    });
}

/* 同步字幕 */
function startSubtitleSync() {
    setInterval(() => {
        if (!player || typeof player.getCurrentTime !== "function") return;

        const currentTime = player.getCurrentTime();

        const sub = subtitles.find(
            s => currentTime >= s.start && currentTime <= s.end
        );

        document.getElementById("subtitle").innerHTML = sub ? sub.text : "";
    }, 200);
}
    </script>

</body>
</html>
